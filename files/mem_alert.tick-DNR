stream
    |from()
        .measurement('mem')
    |groupBy('host', 'service', 'datacenter')
    |window()
        .period(5m)
        .every(5m)
    |alert()
        .id('{{ .Name }}/{{ index .Tags "service" }}/{{ index .Tags "datacenter" }}/{{ index .Tags "host" }}')
        .message('{{ .ID }} is {{ .Level }}')
        .warn(lambda: "used_percent" > 80)
        .crit(lambda: "used_percent" > 90)
        .email()
        .log('/tmp/mem_alerts.log')
